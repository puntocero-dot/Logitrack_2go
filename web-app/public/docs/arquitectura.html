<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logitrack - Arquitectura del Sistema</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1c;
            --bg-secondary: #111827;
            --bg-card: #1f2937;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-yellow: #f59e0b;
            --accent-red: #ef4444;
            --accent-purple: #8b5cf6;
            --border-color: rgba(255,255,255,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            padding: 3rem 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 3rem;
        }

        .logo {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.25rem;
        }

        h1, h2, h3, h4 {
            color: var(--text-primary);
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        h1 { font-size: 2.5rem; }
        h2 { 
            font-size: 1.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--accent-blue);
            display: inline-block;
        }
        h3 { font-size: 1.35rem; color: var(--accent-green); }
        h4 { font-size: 1.15rem; color: var(--text-secondary); }

        p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        .section {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid var(--border-color);
        }

        .diagram {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            border: 1px solid var(--border-color);
        }

        pre {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            color: var(--accent-green);
            white-space: pre;
            margin: 0;
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-card);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
            color: var(--accent-yellow);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--accent-blue);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-green { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }
        .badge-yellow { background: rgba(245, 158, 11, 0.2); color: var(--accent-yellow); }
        .badge-red { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }
        .badge-blue { background: rgba(59, 130, 246, 0.2); color: var(--accent-blue); }

        .role-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            border-left: 4px solid var(--accent-blue);
        }

        .role-card h4 {
            margin-top: 0;
            color: var(--text-primary);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .card-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .card h4 {
            margin-top: 0;
            color: var(--text-primary);
        }

        .highlight-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid var(--accent-blue);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        li {
            margin: 0.5rem 0;
            color: var(--text-secondary);
        }

        .toc {
            position: fixed;
            left: 2rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            max-width: 200px;
        }

        .toc a {
            display: block;
            color: var(--text-secondary);
            text-decoration: none;
            padding: 0.5rem;
            font-size: 0.85rem;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .toc a:hover {
            background: var(--bg-card);
            color: var(--accent-blue);
        }

        @media (max-width: 1400px) {
            .toc { display: none; }
        }

        footer {
            text-align: center;
            padding: 3rem 0;
            margin-top: 3rem;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .emoji {
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body>
    <nav class="toc">
        <a href="#vision">VisiÃ³n General</a>
        <a href="#sucursales">Modelo Sucursales</a>
        <a href="#jerarquia">JerarquÃ­a</a>
        <a href="#transferencias">Transferencias</a>
        <a href="#datos">Modelo de Datos</a>
        <a href="#seguridad">Seguridad</a>
    </nav>

    <div class="container">
        <header>
            <div class="logo">ğŸ—ï¸ LOGITRACK</div>
            <p class="subtitle">Arquitectura del Sistema de GestiÃ³n de Entregas</p>
        </header>

        <!-- VISIÃ“N GENERAL -->
        <section class="section" id="vision">
            <h2><span class="emoji">ğŸ“Š</span>VisiÃ³n General</h2>
            
            <div class="diagram">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           LOGITRACK PLATFORM                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Web App    â”‚  â”‚ Client View â”‚  â”‚ Coord App   â”‚  â”‚ Driver App  â”‚   â”‚
â”‚  â”‚  (React)    â”‚  â”‚  (React)    â”‚  â”‚  (React)    â”‚  â”‚  (React)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                â”‚                â”‚                â”‚           â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                   â”‚                                     â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                          â”‚   API Gateway   â”‚ â† Rate Limiting, CORS     â”‚
â”‚                          â”‚   (Go + Gin)    â”‚   Auth, Logging           â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                   â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚                              â”‚                              â”‚     â”‚
â”‚  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”‚
â”‚  â”‚  User    â”‚  â”‚         Order Service             â”‚  â”‚Integration â”‚  â”‚
â”‚  â”‚ Service  â”‚  â”‚  â€¢ Orders  â€¢ Motos  â€¢ Branches    â”‚  â”‚  Service   â”‚  â”‚
â”‚  â”‚  (Go)    â”‚  â”‚  â€¢ Routes  â€¢ KPIs  â€¢ Visits       â”‚  â”‚   (Go)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                         â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ AI Serviceâ”‚          â”‚   PostgreSQL    â”‚                           â”‚
â”‚  â”‚ (Python)  â”‚          â”‚  (Persistence)  â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <div class="grid">
                <div class="card">
                    <div class="card-icon">âš¡</div>
                    <h4>API Gateway</h4>
                    <p>Puerta de entrada Ãºnica. Rate limiting, CORS, autenticaciÃ³n JWT, logging centralizado.</p>
                </div>
                <div class="card">
                    <div class="card-icon">ğŸ‘¥</div>
                    <h4>User Service</h4>
                    <p>GestiÃ³n de usuarios, roles, autenticaciÃ³n y sesiones.</p>
                </div>
                <div class="card">
                    <div class="card-icon">ğŸ“¦</div>
                    <h4>Order Service</h4>
                    <p>Core del negocio: pedidos, motos, sucursales, rutas, KPIs.</p>
                </div>
                <div class="card">
                    <div class="card-icon">ğŸ¤–</div>
                    <h4>AI Service</h4>
                    <p>Algoritmo Round-Robin para asignaciÃ³n inteligente de pedidos.</p>
                </div>
                <div class="card">
                    <div class="card-icon">ğŸ”Œ</div>
                    <h4>Integration Service</h4>
                    <p>ConexiÃ³n con sistemas externos: APIs, webhooks, importaciÃ³n masiva.</p>
                </div>
                <div class="card">
                    <div class="card-icon">ğŸ—„ï¸</div>
                    <h4>PostgreSQL</h4>
                    <p>Base de datos relacional con todas las entidades del sistema.</p>
                </div>
            </div>
        </section>

        <!-- MODELO DE SUCURSALES -->
        <section class="section" id="sucursales">
            <h2><span class="emoji">ğŸ¢</span>Modelo de Sucursales (CRÃTICO)</h2>
            
            <div class="highlight-box">
                <strong>Principio clave:</strong> Cada sucursal es un "mini-tenant" con sus propios usuarios, motos y pedidos. 
                El aislamiento garantiza que una sucursal NO puede ver los recursos de otra (excepto roles globales).
            </div>

            <div class="diagram">
<pre>
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         LOGITRACK               â”‚
                    â”‚   (Multi-Sucursal / Multi-Tenant)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚                            â”‚
        â–¼                            â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUCURSAL A   â”‚          â”‚  SUCURSAL B   â”‚          â”‚  SUCURSAL C   â”‚
â”‚   (Central)   â”‚          â”‚  (Zona Norte) â”‚          â”‚  (Zona Sur)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               â”‚          â”‚               â”‚          â”‚               â”‚
â”‚ ğŸ‘¤ Usuarios   â”‚          â”‚ ğŸ‘¤ Usuarios   â”‚          â”‚ ğŸ‘¤ Usuarios   â”‚
â”‚  - Supervisor â”‚          â”‚  - Supervisor â”‚          â”‚  - Supervisor â”‚
â”‚  - Analista   â”‚          â”‚  - Drivers    â”‚          â”‚  - Drivers    â”‚
â”‚               â”‚          â”‚               â”‚          â”‚               â”‚
â”‚ ğŸï¸ Motos     â”‚          â”‚ ğŸï¸ Motos     â”‚          â”‚ ğŸï¸ Motos     â”‚
â”‚  - MOTO-001   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  - MOTO-004   â”‚          â”‚  - MOTO-007   â”‚
â”‚  - MOTO-002   â”‚Transferirâ”‚  - MOTO-005   â”‚          â”‚  - MOTO-008   â”‚
â”‚  - MOTO-003   â”‚ temporal â”‚  - MOTO-006   â”‚          â”‚  - MOTO-009   â”‚
â”‚               â”‚          â”‚               â”‚          â”‚               â”‚
â”‚ ğŸ“¦ Pedidos    â”‚          â”‚ ğŸ“¦ Pedidos    â”‚          â”‚ ğŸ“¦ Pedidos    â”‚
â”‚  (Solo suyos) â”‚          â”‚  (Solo suyos) â”‚          â”‚  (Solo suyos) â”‚
â”‚               â”‚          â”‚               â”‚          â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <h3>Reglas de Aislamiento por Sucursal</h3>
            <table>
                <thead>
                    <tr>
                        <th>Rol</th>
                        <th>Alcance de Vista</th>
                        <th>Puede Transferir Motos</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Admin</strong></td>
                        <td>Todas las sucursales</td>
                        <td><span class="badge badge-green">âœ… SÃ­</span></td>
                    </tr>
                    <tr>
                        <td><strong>Gerente</strong></td>
                        <td>Todas las sucursales (solo lectura)</td>
                        <td><span class="badge badge-red">âŒ No</span></td>
                    </tr>
                    <tr>
                        <td><strong>Coordinador</strong></td>
                        <td>Todas las sucursales (visitas)</td>
                        <td><span class="badge badge-red">âŒ No</span></td>
                    </tr>
                    <tr>
                        <td><strong>Supervisor</strong></td>
                        <td>Solo SU sucursal</td>
                        <td><span class="badge badge-green">âœ… SÃ­ (a otra)</span></td>
                    </tr>
                    <tr>
                        <td><strong>Analista</strong></td>
                        <td>Solo SU sucursal</td>
                        <td><span class="badge badge-red">âŒ No</span></td>
                    </tr>
                    <tr>
                        <td><strong>Driver</strong></td>
                        <td>Solo SUS pedidos asignados</td>
                        <td><span class="badge badge-red">âŒ No</span></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- JERARQUÃA -->
        <section class="section" id="jerarquia">
            <h2><span class="emoji">ğŸ‘¥</span>JerarquÃ­a Organizacional</h2>
            
            <div class="diagram">
<pre>
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚    ADMIN     â”‚ â† ConfiguraciÃ³n global
                         â”‚  (Sistema)   â”‚   Todos los accesos
                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                 â”‚                 â”‚
              â–¼                 â–¼                 â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚    GERENTE     â”‚ â”‚ COORDINADOR  â”‚ â”‚    ANALISTA      â”‚
     â”‚  (LogÃ­stica)   â”‚ â”‚   (Visitas)  â”‚ â”‚    (Reportes)    â”‚
     â”‚                â”‚ â”‚              â”‚ â”‚                  â”‚
     â”‚ â€¢ KPIs globalesâ”‚ â”‚ â€¢ Check-in   â”‚ â”‚ â€¢ Alertas        â”‚
     â”‚ â€¢ Overview     â”‚ â”‚ â€¢ Checklist  â”‚ â”‚ â€¢ PredicciÃ³n     â”‚
     â”‚ â€¢ Comparativos â”‚ â”‚ â€¢ AuditorÃ­as â”‚ â”‚ â€¢ Balanceo       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Supervisa
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  SUCURSAL X                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                                 â”‚
     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
     â”‚    â”‚  SUPERVISOR  â”‚ â† Gestiona operaciones      â”‚
     â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   de SU sucursal            â”‚
     â”‚           â”‚                                     â”‚
     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
     â”‚    â”‚              â”‚                             â”‚
     â”‚    â–¼              â–¼                             â”‚
     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”             â”‚
     â”‚ â”‚MOTO 1â”‚     â”‚MOTO 2â”‚     â”‚MOTO 3â”‚             â”‚
     â”‚ â”‚Driverâ”‚     â”‚Driverâ”‚     â”‚Driverâ”‚             â”‚
     â”‚ â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”˜             â”‚
     â”‚                                                 â”‚
     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚ â”‚           PEDIDOS DE LA SUCURSAL         â”‚   â”‚
     â”‚ â”‚  â€¢ Pedido 101  â€¢ Pedido 102  â€¢ Pedido 103â”‚   â”‚
     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚                                                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <div class="grid">
                <div class="role-card">
                    <h4>ğŸ”‘ Admin</h4>
                    <p>Acceso total al sistema. ConfiguraciÃ³n, usuarios, todas las sucursales.</p>
                </div>
                <div class="role-card">
                    <h4>ğŸ“ˆ Gerente de LogÃ­stica</h4>
                    <p>Dashboard gerencial con KPIs globales, comparativos entre sucursales.</p>
                </div>
                <div class="role-card">
                    <h4>ğŸ“‹ Coordinador</h4>
                    <p>Check-in GPS en sucursales, checklist de auditorÃ­a, registro de visitas.</p>
                </div>
                <div class="role-card">
                    <h4>ğŸ“Š Supervisor</h4>
                    <p>GestiÃ³n operativa de SU sucursal: pedidos, motos, optimizaciÃ³n.</p>
                </div>
                <div class="role-card">
                    <h4>ğŸ“‰ Analista</h4>
                    <p>Reportes, alertas de capacidad, predicciÃ³n de demanda.</p>
                </div>
                <div class="role-card">
                    <h4>ğŸï¸ Driver</h4>
                    <p>App mÃ³vil para entregas: rutas, confirmaciones, tracking GPS.</p>
                </div>
            </div>
        </section>

        <!-- TRANSFERENCIAS -->
        <section class="section" id="transferencias">
            <h2><span class="emoji">ğŸ”„</span>Transferencia de Motos entre Sucursales</h2>
            
            <p>Cuando una sucursal tiene alta demanda y otra tiene motos disponibles, se puede realizar una transferencia temporal.</p>

            <div class="diagram">
<pre>
ESCENARIO: Sucursal A tiene muchos pedidos, Sucursal B tiene motos libres

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUCURSAL A  â”‚                              â”‚ SUCURSAL B  â”‚
â”‚             â”‚                              â”‚             â”‚
â”‚ ğŸï¸ MOTO-001 â”‚                              â”‚ ğŸï¸ MOTO-004 â”‚
â”‚ ğŸï¸ MOTO-002 â”‚                              â”‚ ğŸï¸ MOTO-005 â”‚ â† Libre
â”‚             â”‚                              â”‚ ğŸï¸ MOTO-006 â”‚ â† Libre
â”‚ ğŸ“¦ 15 pedidosâ”‚                              â”‚ ğŸ“¦ 2 pedidos â”‚
â”‚    pendientesâ”‚                              â”‚    pendientesâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                            â”‚
       â”‚  Supervisor A solicita apoyo               â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                            â”‚
       â”‚        Admin/Gerente autoriza              â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
       â”‚                                            â”‚
       â”‚     MOTO-005 transferida temporalmente     â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                            â”‚
       â–¼                                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUCURSAL A  â”‚                              â”‚ SUCURSAL B  â”‚
â”‚             â”‚                              â”‚             â”‚
â”‚ ğŸï¸ MOTO-001 â”‚                              â”‚ ğŸï¸ MOTO-004 â”‚
â”‚ ğŸï¸ MOTO-002 â”‚                              â”‚ ğŸï¸ MOTO-006 â”‚
â”‚ ğŸï¸ MOTO-005 â”‚ â† Temporal                   â”‚             â”‚
â”‚   (de B)    â”‚                              â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

* Al finalizar el turno, MOTO-005 regresa automÃ¡ticamente a Sucursal B
</pre>
            </div>

            <h3>API de Transferencias</h3>
            <table>
                <thead>
                    <tr>
                        <th>Endpoint</th>
                        <th>MÃ©todo</th>
                        <th>DescripciÃ³n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>POST /transfers</code></td>
                        <td>POST</td>
                        <td>Crear transferencia temporal o permanente</td>
                    </tr>
                    <tr>
                        <td><code>PUT /motos/:id/return</code></td>
                        <td>PUT</td>
                        <td>Regresar moto a su sucursal original</td>
                    </tr>
                    <tr>
                        <td><code>GET /transfers</code></td>
                        <td>GET</td>
                        <td>Listar motos actualmente transferidas</td>
                    </tr>
                    <tr>
                        <td><code>GET /transfers/history</code></td>
                        <td>GET</td>
                        <td>Historial de transferencias</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- MODELO DE DATOS -->
        <section class="section" id="datos">
            <h2><span class="emoji">ğŸ“‹</span>Modelo de Datos</h2>
            
            <div class="diagram">
<pre>
users                          motos                         orders
â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€                         â”€â”€â”€â”€â”€â”€
id                             id                            id
name                           license_plate                 client_name
email                          driver_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º address
role                           branch_id â”€â”€â”€â”€â”€â”              status
branch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º current_branch_id â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  branch â”€â”€â”€â”€â”€â”
                               status                        assigned_moto_id
                               latitude                      latitude
                               longitude                     longitude
         â”‚                     max_orders_capacity
         â”‚                     transfer_expires_at
         â”‚                              â”‚
         â”‚                              â”‚
         â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ branchesâ”‚                 â”‚  moto_transfers â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    id                          id
    name                        moto_id
    code                        from_branch_id
    latitude                    to_branch_id
    longitude                   transferred_by
    radius_km                   expires_at
    is_active                   status
</pre>
            </div>
        </section>

        <!-- SEGURIDAD -->
        <section class="section" id="seguridad">
            <h2><span class="emoji">ğŸ”</span>Filtros de Seguridad por Sucursal</h2>
            
            <p>Todas las consultas del backend aplican filtros automÃ¡ticos segÃºn el rol del usuario:</p>

            <div class="diagram">
<pre>
// Backend (Go)
func GetMotos(c *gin.Context) {
    userBranch := c.GetHeader("X-User-Branch")
    userRole := c.GetHeader("X-User-Role")
    
    query := "SELECT * FROM motos"
    
    // Solo admin/manager/coordinator ven todas las sucursales
    if userRole != "admin" && userRole != "manager" && userRole != "coordinator" {
        query += " WHERE current_branch_id = (SELECT id FROM branches WHERE code = ?)"
        // AÃ±adir userBranch como parÃ¡metro
    }
}
</pre>
            </div>

            <div class="highlight-box">
                <strong>Resultado:</strong> Un supervisor de "Zona Norte" NUNCA podrÃ¡ ver motos o pedidos de "Central" o "Zona Sur", 
                incluso si intenta modificar la URL o los parÃ¡metros de la API.
            </div>
        </section>

        <footer>
            <p>ğŸ“„ Documento generado para Logitrack</p>
            <p>Ãšltima actualizaciÃ³n: Diciembre 2024</p>
        </footer>
    </div>
</body>
</html>
